import{j as W,u as Qe,a as Me,y as Be,r as m,a2 as Oe,a3 as Fe,a4 as ze,a5 as Ve,b as a,ad as Ye,L as _e}from"./index-a50eb7ee.js";/* empty css                       */import{w as qe,S as Ge}from"./sweetalert2.all-953600d6.js";import{C as Je,a as Ke,Q as Ue,L as Xe}from"./ListOccupants-8a7778c2.js";import{B as Ze}from"./Breadcrumb-c6b78098.js";import{C as De,H as we}from"./HighlightOffRounded-a10a3f8c.js";import{A as Ie}from"./Alert-5e12cda2.js";function ca(){return window.document.title="QR Scanning (Post-Evacuation) | WebEEMS",W({})}function na(){var B,O,F,z,V,Y,_,q,G,J,K,U,X,Z,I,ee,ae,te,se,ie,le,re,ce,ne,oe,de,ue,me,he,Ee,ve,xe,ge,pe,be,fe;const i=Qe(),$=Me(),N=Be(),[e,L]=m.useState({}),[l,P]=m.useState({}),[y,x]=m.useState(null),[D,T]=m.useState(!1),[k,He]=m.useState(null),[H,S]=m.useState(!1),[b,f]=m.useState(!1),[Q,Se]=m.useState(!1),C=qe(Ge),E=C.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",C.stopTimer),t.addEventListener("mouseleave",C.resumeTimer)}}),M=C.mixin({input:"text",inputAttributes:{autocapitalize:"off"},inputAutoTrim:!0,inputAutoFocus:!0,inputPlaceholder:"Enter Evacuee ID Manually",showCancelButton:!0,confirmButtonText:"Look up",showLoaderOnConfirm:!0,preConfirm:t=>Oe(t).then(({success:s})=>W(s?t:null).json()).catch(()=>W(null).json()),allowOutsideClick:()=>!C.isLoading()});m.useEffect(()=>{var t,s,n,o,r,d,c,u,h,g,j,v,p;N.state==="idle"&&(Q?((t=i==null?void 0:i.loginInfo)==null?void 0:t.Role)==="admin"?(i==null?void 0:i.myAssignedEvent)===null?($("..",{replace:!0}),E.fire({icon:"error",title:"Invalid Access! You have not selected any Evacuation Event ID."}).then()):((o=(s=i==null?void 0:i.myAssignedEvent)==null?void 0:s.Assigned)!=null&&o.includes((n=i==null?void 0:i.loginInfo)==null?void 0:n.ID)&&Fe(i.myAssignedEvent.ID,i.loginInfo.ID).catch(()=>{$("..",{replace:!0}),E.fire({icon:"error",title:"Something went wrong! Please Try Again."}).then()}),H||setTimeout(()=>S(!0),1e3)):(r=i==null?void 0:i.loginInfo)!=null&&r.Permissions.includes("post-evacuation-scan")&&((u=(c=(d=i==null?void 0:i.myAssignedEvent)==null?void 0:d.PostEvacuation)==null?void 0:c.Started)==null?void 0:u.getTime())<=Date.now()&&(!((g=(h=i==null?void 0:i.myAssignedEvent)==null?void 0:h.PostEvacuation)!=null&&g.Ended)||((p=(v=(j=i==null?void 0:i.myAssignedEvent)==null?void 0:j.PostEvacuation)==null?void 0:v.Ended)==null?void 0:p.getTime())>Date.now())?H||setTimeout(()=>S(!0),1e3):$("..",{replace:!0}):(i!=null&&i.myAssignedEvent||(i==null?void 0:i.myAssignedEvent)===null)&&Se(!0))},[i,i==null?void 0:i.myAssignedEvent,N==null?void 0:N.state,$,H,Q]),m.useEffect(()=>{var t;if(N.state==="idle"&&H)if((t=i==null?void 0:i.myAssignedEvent)!=null&&t.ID)ze(i.myAssignedEvent.ID,"post").then(({success:s})=>{e!==s&&L(s),S(!1)}).catch(s=>{console.error(s),S(!1)});else return()=>{T(!1),f(!1),x(null),S(!1),P({}),L({})}},[N==null?void 0:N.state,e,H,i==null?void 0:i.myAssignedEvent]),m.useEffect(()=>{(D&&y!==null||b===!0&&y!==null)&&Ve(y).then(({success:t})=>{t&&(P(t),setTimeout(()=>k==null?void 0:k.scrollIntoView({behavior:"smooth"}),15),f(!1))}).catch(console.error)},[k,y,D,l,b]);const Ce=m.useCallback(t=>t!==null&&y!==t&&x(t),[y]),Ae=m.useCallback(()=>{var t;return e&&((t=e.PostEvacuation)==null?void 0:t.Evacuated)instanceof Array?e.PostEvacuation.Evacuated.map(({ID:{HouseID:s}})=>s):[]},[e]),$e=m.useCallback(()=>{var t,s,n;return e&&((t=e.PostEvacuation)==null?void 0:t.Evacuated)instanceof Array?e.PostEvacuation.Evacuated.reduce(({Present:o,value:r},{ID:{HouseID:d,Household:{Head:c,Members:u}}},h)=>{const g=["table-light","table-warning","table-secondary","table-info","table-danger"],j=u.reduce((v,p)=>[...v,{Name:p.Name,Suffx:p.Suffx,Age:p.Age}],[c?{Name:c.Name,Suffx:c.Suffx,Age:c.Age}:[]]);return{Present:o,value:[...r,a.jsx("div",{className:"table-responsive p-0 m-0",children:a.jsx("table",{className:`table table-striped-columns table-bordered p-0 m-0 ${g[h%g.length]}`,children:a.jsx("tbody",{children:j.map((v,p)=>a.jsxs("tr",{children:[a.jsx("td",{scope:"row",children:`${v.Name} ${!v.Suffx||v.Suffx==="none"?"":v.Suffx}`}),a.jsx("td",{children:v.Age}),a.jsx("td",{children:o[d].includes(v.Name)?a.jsx(Je,{color:"success"}):a.jsx(Ke,{color:"error"})})]},`post-evacuation-occupants-tr-${p}`))})})},`post-evacuation-occupants-${h}`)]}},{Present:((n=(s=e==null?void 0:e.PreEvacuation)==null?void 0:s.Evacuated)==null?void 0:n.reduce((o,r)=>({...o,[r.ID]:r.Present}),{}))||{},value:[]}):[]},[e]),w=m.useCallback(t=>{var s,n;return(n=(s=e==null?void 0:e.PreEvacuation)==null?void 0:s.Evacuated)==null?void 0:n.reduce((o,{ID:r})=>{var d,c;return o||(l==null?void 0:l.HouseID)===r&&((c=(d=e==null?void 0:e.PreEvacuation)==null?void 0:d.Evacuated)==null?void 0:c.reduce((u,h)=>u||h.ID===r&&h.Present.includes(t),!1))},!1)},[e,l]),ke=m.useCallback(t=>{var n,o;t.preventDefault(),t.stopPropagation();const s=l==null?void 0:l.HouseID;((o=(n=e==null?void 0:e.PostEvacuation)==null?void 0:n.Evacuated)==null?void 0:o.length)>0&&e.PostEvacuation.Evacuated.map(r=>r.ID.HouseID).includes(l.HouseID)&&E.fire({icon:"info",title:`Evacuee ID ${s} already left the evacuation site.`,text:`Persons: ${A(s)} persons already left the evacuation site`}).then(()=>{P({}),x(null)}),Ye(e==null?void 0:e.ID,s).then(({success:r})=>{var d,c,u,h,g,j,v,p;r?(E.fire({icon:"success",title:`Successfully processed Evacuee ID ${s} for Post-Evacuation`,text:`${((c=(d=r==null?void 0:r.PostEvacuation)==null?void 0:d.Evacuated)==null?void 0:c.reduce((R,Pe)=>{var ye,je;return Pe.ID===s?(je=(ye=r==null?void 0:r.PreEvacuation)==null?void 0:ye.Evacuated)==null?void 0:je.reduce((Te,Ne)=>Ne.ID===Pe.ID?Ne.Present.length:Te,0):R},0))||0} persons may now leave the evacuation site for relocation`}).then(()=>P({})),b&&f(!1),x(null)):(h=(u=e==null?void 0:e.PostEvacuation)==null?void 0:u.Evacuated)!=null&&h.map(R=>R.ID.HouseID).includes(s)?(E.fire({icon:"info",title:`Evacuee ID ${s} already left the evacuation site.`,text:`Persons: ${A(s)} persons already left the evacuation site`}).then(()=>P({})),b&&f(!1),x(null)):((j=(g=e==null?void 0:e.PreEvacuation)==null?void 0:g.Evacuated)==null?void 0:j.length)===((p=(v=e==null?void 0:e.PostEvacuation)==null?void 0:v.Evacuated)==null?void 0:p.length)?(E.fire({icon:"error",title:`All ${e==null?void 0:e.PostEvacuation.Evacuated.length} evacuess has left the building!`,text:"Cannot proceed any further."}).then(()=>P({})),b&&f(!1),x(null)):E.fire({icon:"error",title:`Failed to process Evacuee ID ${s} for Post-Evacuation. Please Try Again!`}).then()}).catch(()=>{var r,d,c,u,h,g;(d=(r=e==null?void 0:e.PostEvacuation)==null?void 0:r.Evacuated)!=null&&d.map(j=>j.ID.HouseID).includes(s)?(E.fire({icon:"info",title:`Evacuee ID ${s} already left the evacuation site.`,text:`Persons: ${A(s)} persons already left the evacuation site`}).then(()=>P({})),b&&f(!1),x(null)):((u=(c=e==null?void 0:e.PreEvacuation)==null?void 0:c.Evacuated)==null?void 0:u.length)===((g=(h=e==null?void 0:e.PostEvacuation)==null?void 0:h.Evacuated)==null?void 0:g.length)?(E.fire({icon:"error",title:`All ${e==null?void 0:e.PostEvacuation.Evacuated.length} evacuees has left the building!`,text:"Cannot proceed any further."}).then(()=>P({})),b&&f(!1),x(null)):E.fire({icon:"error",title:`Failed to process Evacuee ID ${s} for Post-Evacuation. Please Try Again!`}).then()})},[l,e,E,b]),Re=m.useCallback(t=>{t.preventDefault(),M.fire({title:"Evacuee QR ID"}).then(s=>{var n,o;s.isConfirmed&&(s.value?(o=(n=e==null?void 0:e.PreEvacuation)==null?void 0:n.Evacuated)!=null&&o.reduce((r,d)=>r||d.ID===s.value.trim(),!1)?(b||f(!0),x(s.value.trim())):(f(!1),x(null),E.fire({icon:"info",title:"Evacuation ID is not registered to the current evacuation event!"}).then()):(f(!1),x(null),E.fire({icon:"info",title:"Evacuation ID not found!"}).then()))})},[M,E,e,b]),We=m.useCallback(()=>{var t,s,n,o,r,d;return(d=(t=e==null?void 0:e.PostEvacuation)==null?void 0:t.Evacuated)==null?void 0:d.reduce(({Present:c,value:u},{ID:{HouseID:h}})=>({Present:c,value:u-c[h].length}),{Present:((n=(s=e==null?void 0:e.PreEvacuation)==null?void 0:s.Evacuated)==null?void 0:n.reduce((c,u)=>({...c,[u.ID]:u.Present}),{}))||{},value:(r=(o=e==null?void 0:e.PreEvacuation)==null?void 0:o.Evacuated)==null?void 0:r.reduce((c,u)=>c+(u.Present?u.Present.length:0)||0,0)})},[e]),Le=m.useCallback(()=>{var t,s,n,o;return(o=(t=e==null?void 0:e.PostEvacuation)==null?void 0:t.Evacuated)==null?void 0:o.reduce(({Present:r,value:d},{ID:{HouseID:c}})=>({Present:r,value:d+r[c].length}),{Present:((n=(s=e==null?void 0:e.PreEvacuation)==null?void 0:s.Evacuated)==null?void 0:n.reduce((r,d)=>({...r,[d.ID]:d.Present}),{}))||{},value:0})},[e]),A=m.useCallback(t=>{var s,n;return((n=(s=e==null?void 0:e.PreEvacuation)==null?void 0:s.Evacuated)==null?void 0:n.reduce((o,r)=>(t?r.ID===t:r.ID===(l==null?void 0:l.HouseID))?r.Present.length:o,0))||0},[e,l]);return a.jsxs(a.Fragment,{children:[!(e!=null&&e.ID)&&a.jsx(_e,{}),a.jsx("div",{className:"container pt-3",children:a.jsx(Ze,{items:[{title:"Home",href:"/"},{title:"Post-evacuation",href:"/post-evacuation"},{title:"QR Scanning",href:"."},{title:e==null?void 0:e.ID}]})}),a.jsx("div",{className:"container mb-5 pb-3 main-container bg-light bg-opacity-50",children:a.jsxs("div",{className:"row overflow-hidden w-100 h-100 my-auto mx-auto mx-lg-0",children:[a.jsx("div",{className:"col-12 col-md-9 col-lg-8 my-3",children:a.jsxs("div",{className:"card h-100",children:[a.jsx("div",{className:"card-header h2",children:"Post-Evacuation QR Scan"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"w-100 d-flex flex-column justify-content-center align-items-center",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx(Ue,{className:"border border-2 rounded-5 mx-auto",videoClassName:"rounded-5",onResult:Ce,start:D,style:{width:"300px",height:"300px"}}),a.jsxs("div",{className:"mt-3 d-flex flex-row justify-content-evenly",children:[a.jsx("button",{onClick:()=>T(!D),type:"button",className:`btn btn-outline-${D?"danger":"primary"}`,children:D?"Stop Scanning":"Scan Qr Code"}),a.jsx("button",{onClick:Re,type:"button",className:"btn btn-outline-secondary",children:"Manual QR Code"})]})]}),a.jsxs("div",{className:"mt-3",children:["Scanned ID: ",y]}),a.jsxs("div",{className:"d-flex align-items-center justify-content-center mt-5 h4 w-100",children:[a.jsx("div",{className:"border border-2 ps-3 py-2 text-start bg-success-subtle",style:{minWidth:"10em",maxWidth:"20em"},children:"Evacuees Inside:"}),a.jsx("div",{className:`border border-2 text-center py-2 text-light bg-${(B=e==null?void 0:e.PostEvacuation)!=null&&B.Evacuated&&((O=e==null?void 0:e.PreEvacuation)!=null&&O.Evacuated)&&e.PostEvacuation.Evacuated.length>=e.PreEvacuation.Evacuated.length?"danger":(F=e==null?void 0:e.PostEvacuation)!=null&&F.Evacuated&&((z=e==null?void 0:e.PreEvacuation)!=null&&z.Evacuated)&&e.PreEvacuation.Evacuated.length-e.PostEvacuation.Evacuated.length<5?"warning text-dark":"success-subtle text-dark"}`,style:{minWidth:"3em",maxWidth:"3em"},children:(V=e==null?void 0:e.PostEvacuation)!=null&&V.Evacuated&&((Y=e==null?void 0:e.PreEvacuation)!=null&&Y.Evacuated)?e.PreEvacuation.Evacuated.length-e.PostEvacuation.Evacuated.length:"-"})]}),a.jsxs("div",{className:"d-flex align-items-center justify-content-center mt-3 h4 w-100",children:[a.jsx("div",{className:"border border-2 ps-3 py-2 text-start bg-info-subtle",style:{minWidth:"10em",maxWidth:"20em"},children:"Evacuees Left:"}),a.jsx("div",{className:`border border-2 text-center py-2 text-light bg-${(_=e==null?void 0:e.PostEvacuation)!=null&&_.Evacuated&&((q=e==null?void 0:e.PreEvacuation)!=null&&q.Evacuated)&&e.PostEvacuation.Evacuated.length>=e.PreEvacuation.Evacuated.length?"danger":(G=e==null?void 0:e.PostEvacuation)!=null&&G.Evacuated&&((J=e==null?void 0:e.PreEvacuation)!=null&&J.Evacuated)&&e.PreEvacuation.Evacuated.length-e.PostEvacuation.Evacuated.length<5?"warning text-dark":"info-subtle text-dark"}`,style:{minWidth:"3em",maxWidth:"3em"},children:(K=e==null?void 0:e.PostEvacuation)!=null&&K.Evacuated?e.PostEvacuation.Evacuated.length:"-"})]}),a.jsxs("div",{className:"d-flex align-items-center justify-content-center mt-3 h4 w-100",children:[a.jsx("div",{className:"border border-2 ps-3 py-2 text-start bg-danger-subtle",style:{minWidth:"10em",maxWidth:"20em"},children:"Persons Inside:"}),a.jsx("div",{className:"border border-2 text-center py-2",style:{minWidth:"3em",maxWidth:"3em"},children:((U=We())==null?void 0:U.value)||"-"})]}),a.jsxs("div",{className:"d-flex align-items-center justify-content-center mt-3 h4 w-100",children:[a.jsx("div",{className:"border border-2 ps-3 py-2 text-start bg-success-subtle",style:{minWidth:"10em",maxWidth:"20em"},children:"Persons Left:"}),a.jsx("div",{className:"border border-2 text-center py-2",style:{minWidth:"3em",maxWidth:"3em"},children:((X=Le())==null?void 0:X.value)||"-"})]})]})}),a.jsx("div",{className:"card-footer"})]})}),a.jsx("div",{className:"col my-3",children:a.jsxs("div",{className:"card h-100",children:[y&&(l==null?void 0:l.HouseID)&&a.jsx("div",{className:"card-header h3",children:l==null?void 0:l.HouseID}),a.jsx("div",{className:"card-body position-relative",style:{float:"left",clear:"both"},ref:He,children:y&&(l==null?void 0:l.HouseID)&&a.jsxs("form",{onSubmit:ke,children:[a.jsx("h4",{children:"Head"}),a.jsx("div",{className:"table-responsive",children:a.jsx("table",{className:"table table-striped-columns table-warning",children:a.jsx("tbody",{children:a.jsxs("tr",{children:[a.jsx("td",{scope:"row",className:"text-start",children:a.jsxs("div",{className:"w-100 d-flex flex-row justify-content-start align-items-center text-start",children:[w((I=(Z=l==null?void 0:l.Household)==null?void 0:Z.Head)==null?void 0:I.Name)?a.jsx(De,{color:"success",className:"mx-2"}):a.jsx(we,{color:"error",className:"mx-2"}),a.jsx("div",{className:`${w((ae=(ee=l==null?void 0:l.Household)==null?void 0:ee.Head)==null?void 0:ae.Name)?"text-dark":"text-secondary"}`,children:((se=(te=l.Household)==null?void 0:te.Head)==null?void 0:se.Name)+(((le=(ie=l.Household)==null?void 0:ie.Head)==null?void 0:le.Suffx)!=="none"?` ${((ce=(re=l.Household)==null?void 0:re.Head)==null?void 0:ce.Suffx)||""}`:"")})]})}),a.jsxs("td",{className:`${w((oe=(ne=l==null?void 0:l.Household)==null?void 0:ne.Head)==null?void 0:oe.Name)?"text-dark":"text-secondary"} py-3`,children:["(age: ",(ue=(de=l.Household)==null?void 0:de.Head)==null?void 0:ue.Age,")"]})]})})})}),a.jsxs("h4",{children:["Members",` (+${(me=l.Household)==null?void 0:me.Members.length})`]}),a.jsx("div",{className:"overflow-y-auto overflow-x-hidden border",style:{height:"20em"},children:a.jsx("div",{className:"table-responsive",children:a.jsx("table",{className:"table table-striped-columns",children:a.jsx("tbody",{children:((he=l.Household)==null?void 0:he.Members.length)>0&&((Ee=l.Household)==null?void 0:Ee.Members.map((t,s)=>a.jsxs("tr",{children:[a.jsx("td",{scope:"row",className:"text-start",children:a.jsxs("div",{className:"w-100 d-flex flex-row justify-content-start align-items-center text-start",children:[w(t.Name)?a.jsx(De,{color:"success",className:"mx-2"}):a.jsx(we,{color:"error",className:"mx-2"}),a.jsx("div",{className:`${w(t.Name)?"text-dark":"text-secondary"}`,children:t.Name+(t.Suffx!=="none"?` ${t.Suffx||""}`:"")})]})}),a.jsxs("td",{className:`${w(t.Name)?"text-dark":"text-secondary"} py-3`,children:["(age: ",t.Age,")"]})]},`members_${s}${t.Name.split(" ")[0]}`)))})})})}),a.jsx("br",{}),a.jsxs("div",{className:"w-100 pe-4",children:[a.jsx(Ie,{severity:((xe=(ve=e==null?void 0:e.PostEvacuation)==null?void 0:ve.Evacuated)==null?void 0:xe.length)>0&&e.PostEvacuation.Evacuated.map(t=>t.ID.HouseID).includes(l.HouseID)?"warning":"info",className:"mb-2",children:((pe=(ge=e==null?void 0:e.PostEvacuation)==null?void 0:ge.Evacuated)==null?void 0:pe.length)>0&&e.PostEvacuation.Evacuated.map(t=>t.ID.HouseID).includes(l.HouseID)?`${l.HouseID} has already evacuated! No. of Persons: ${A()} persons`:`Please confirm evacuees leaving the evacuation site. Present: ${A()} persons`}),a.jsx("button",{type:"submit",className:`btn btn-success me-2 ${((fe=(be=e==null?void 0:e.PostEvacuation)==null?void 0:be.Evacuated)==null?void 0:fe.length)>0&&e.PostEvacuation.Evacuated.map(t=>t.ID.HouseID).includes(l.HouseID)?"disabled":""}`,children:"Confirm"}),a.jsx("button",{type:"reset",className:"btn btn-secondary ms-2",onClick:()=>{x(null),P({})},children:"Cancel"})]})]})}),a.jsx("div",{className:"card-footer position-relative",style:{maxHeight:"20em"},children:a.jsx(Xe,{name:"post-evacuation",labels:Ae(),contents:$e().value,style:{maxHeight:"19em",fontSize:"10pt"},contentStyle:{maxHeight:"19em",fontSize:"10pt",textAlign:"left"}})})]})})]})})]})}export{na as Component,ca as loader};
