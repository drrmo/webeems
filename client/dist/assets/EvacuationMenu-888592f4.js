import{j as Q,a as H,u as W,r as S,R as L,S as M,U as Y,a7 as z,W as q,a4 as U,b as o,Z as V,$ as Z,a8 as G}from"./index-a50eb7ee.js";/* empty css                   */import{w as $,S as y}from"./sweetalert2.all-953600d6.js";import{M as I}from"./MenuButton-2b400b7f.js";import{B as J}from"./Breadcrumb-c6b78098.js";import"./createSvgIcon-d2f0689e.js";import"./useId-519d9372.js";import"./useControlled-20eeda9a.js";function se(){return window.document.title="Evacuation | WebEEMS",Q({})}function oe(){var D,A,b,B,j,T,k;const m=H(),e=W(),f=$(y),c=$(y.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,didOpen:r=>{r.addEventListener("mouseenter",y.stopTimer),r.addEventListener("mouseleave",y.resumeTimer)}})),p=S.useCallback((r,u)=>f.mixin({title:r,input:"select",inputOptions:u,inputPlaceholder:"Select an Evacuation Event ID",confirmButtonText:"Select Evacuation Event",showLoaderOnConfirm:!0,showCancelButton:!0,inputValidator:n=>new Promise(t=>{L().then(({success:i})=>{i.map(a=>a.ID).includes(n)?t():t(`ERROR: \`${n}\` is not found`)}).catch(i=>{var a;t(`ERROR: ${(i==null?void 0:i.message)||((a=i==null?void 0:i.error)==null?void 0:a.message)||i}`)})}),allowOutsideClick:()=>!y.isLoading()}),[f]),w=S.useCallback(r=>{var u;switch(r){case"start":{(async()=>{var i,a,l;let n;if(((i=e==null?void 0:e.loginInfo)==null?void 0:i.Role)==="admin")try{const{success:s}=await q("evac"),d=await p("Select Event ID",s.reduce((g,v)=>({"Evacuation ID":{[v.ID]:v.ID,...g["Evacuation ID"]}}),{"Evacuation ID":{}})).fire();if(d.isConfirmed){if(!d.value){c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}n=d.value}else return}catch{c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}const t=f.mixin({title:`Start the Evacuation Process \`${n||((a=e==null?void 0:e.myAssignedEvent)==null?void 0:a.ID)}\` now?`,text:"Starting Evacuation process will proceed to QR Code Scanning for relief operation",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No",allowOutsideClick:!1});U(n||((l=e==null?void 0:e.myAssignedEvent)==null?void 0:l.ID),"evac").then(s=>{var d,g,v;(d=s==null?void 0:s.success)!=null&&d.Evacuation&&!((v=(g=s==null?void 0:s.success)==null?void 0:g.Evacuation)!=null&&v.Started)&&t.fire({}).then(F=>{var O;F.isConfirmed?G(n||((O=e==null?void 0:e.myAssignedEvent)==null?void 0:O.ID)).then(({success:h})=>{var E;h?(c.fire({icon:"success",title:"Successfully Started Relief Operation (Evacuation Process)",text:"You may now proceed to QR Code Scanning",timer:5e3}).then(()=>m("scan")),((E=e==null?void 0:e.loginInfo)==null?void 0:E.Role)==="admin"&&(e==null||e.setAdminSelectedEventID(n)),m(".")):(c.fire({icon:"error",title:"Failed to Start Evacuation Process! Please Try again",timer:3e3}).then(),m("."))}).catch(h=>{var E,N;c.fire({icon:"error",title:"Failed to Start Evacuation Process! Please Try again",text:`Reason: ${h.message||((E=h.data)==null?void 0:E.message)||((N=h.error)==null?void 0:N.message)||"Something went wrong."}`,timer:3e3}).then(),m(".")}):f.fire({title:"Canceled",icon:"error"}).then()})}).catch(console.error)})().then();break}case"end":{(async()=>{var t,i;let n;if(((t=e==null?void 0:e.loginInfo)==null?void 0:t.Role)==="admin")try{const{success:a}=await Y("evac"),l=await p("Select Event ID",a.reduce((s,d)=>({"Pre-Evacuation ID":{[d.ID]:d.ID,...s["Pre-Evacuation ID"]}}),{"Pre-Evacuation ID":{}})).fire();if(l.isConfirmed){if(!l.value){c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}n=l.value}else return}catch(a){console.log(a),c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}f.fire({title:`Stop the Relief Operation Evacuation Process \`${n||((i=e==null?void 0:e.myAssignedEvent)==null?void 0:i.ID)}\` now?`,text:"Stopping Evacuation will stop relief distribution QR Code Scanning event",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No"}).then(a=>{var l;a.isConfirmed&&z(n||((l=e==null?void 0:e.myAssignedEvent)==null?void 0:l.ID)).then(({success:s})=>{s?(c.fire({icon:"success",title:"Successfully Ended Relief Operation Evacuation Process!",timer:2e3}).then(()=>m(".")),e==null||e.setAdminSelectedEventID(null),m(".")):(c.fire({icon:"error",title:"Failed to End Relief Operation Evacuation Process! Please Try again",timer:2e3}).then(),m("."))}).catch(s=>{var d,g;c.fire({icon:"error",title:"Failed to Stop Relief Operation Evacuation Process! Please Try again",text:`Reason: ${s.message||((d=s.data)==null?void 0:d.message)||((g=s.error)==null?void 0:g.message)||"Something went wrong."}`,timer:2e3}).then(),m(".")})})})().then();break}case"scan":((u=e==null?void 0:e.loginInfo)==null?void 0:u.Role)==="admin"?M("evac").then(async({success:n})=>{var i;const t=await p("Select Event ID",n.reduce((a,l)=>({"Evacuation ID":{[l.ID]:l.ID,...a["Evacuation ID"]}}),{"Evacuation ID":{}})).fire();t.isConfirmed&&(t.value?(c.fire({icon:"success",title:`Entering Relief Operation Evacuation \`${t.value}\` QR Scanning`,timer:1e3}).then(()=>m("scan")),((i=e==null?void 0:e.loginInfo)==null?void 0:i.Role)==="admin"&&(e==null||e.setAdminSelectedEventID(t.value)),m(".")):c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then())}).catch(()=>{c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then()}):m("scan");break}},[p,f,c,e,m]),R=S.useCallback(()=>{var r,u,n,t;return!!((r=e==null?void 0:e.loginInfo)!=null&&r.Permissions.includes("evacuation-modify")&&!((n=(u=e==null?void 0:e.myAssignedEvent)==null?void 0:u.Evacuation)!=null&&n.Started)||((t=e==null?void 0:e.loginInfo)==null?void 0:t.Role)==="admin")},[(D=e==null?void 0:e.loginInfo)==null?void 0:D.Permissions,(A=e==null?void 0:e.loginInfo)==null?void 0:A.Role,e==null?void 0:e.myAssignedEvent]),P=S.useCallback(()=>{var r,u,n,t,i,a,l;return!!((r=e==null?void 0:e.loginInfo)!=null&&r.Permissions.includes("evacuation-scan")&&(e!=null&&e.myAssignedEvent)&&((n=(u=e.myAssignedEvent.Evacuation)==null?void 0:u.Started)==null?void 0:n.getTime())<=Date.now()&&(!((t=e.myAssignedEvent.Evacuation)!=null&&t.Ended)||((a=(i=e.myAssignedEvent.Evacuation)==null?void 0:i.Ended)==null?void 0:a.getTime())>Date.now())||((l=e==null?void 0:e.loginInfo)==null?void 0:l.Role)==="admin")},[(b=e==null?void 0:e.loginInfo)==null?void 0:b.Permissions,(B=e==null?void 0:e.loginInfo)==null?void 0:B.Role,e.myAssignedEvent]),C=S.useCallback(()=>{var r,u,n,t,i;return!!((r=e==null?void 0:e.loginInfo)!=null&&r.Permissions.includes("evacuation-modify")&&(e!=null&&e.myAssignedEvent)&&((n=(u=e.myAssignedEvent.Evacuation)==null?void 0:u.Started)==null?void 0:n.getTime())<=Date.now()&&!((t=e.myAssignedEvent.Evacuation)!=null&&t.Ended)||((i=e==null?void 0:e.loginInfo)==null?void 0:i.Role)==="admin")},[(j=e==null?void 0:e.loginInfo)==null?void 0:j.Permissions,(T=e==null?void 0:e.loginInfo)==null?void 0:T.Role,e.myAssignedEvent]);return o.jsxs(o.Fragment,{children:[o.jsx("div",{className:"container pt-3",children:o.jsx(J,{items:[{title:"Home",href:"/"},{title:"evacuation",href:"/evacuation"}]})}),o.jsx("div",{className:"container main-container",children:o.jsxs("div",{className:"row mx-auto w-100 mb-5 h-75 justify-content-center align-items-center",style:{minHeight:"80vh"},children:[R()&&o.jsx("div",{className:"col-11 col-sm-10 col-lg-6 pb-3 mx-auto my-auto",children:o.jsx(I,{onClick:()=>w("start"),title:"Start Evacuation Process",subtitle:`Start the Evacuation Process now.
                            Starting the Evacuation process will proceed to QR Code Scanning
                            for Evacuees to received relief goods.`,titleStyle:{fontSize:"1.8em"},className:"mx-auto",style:{maxWidth:"25em"}})}),P()&&o.jsx("div",{className:"col-11 col-sm-10 col-lg-6 pb-3 mx-auto my-auto",children:o.jsx(I,{onClick:()=>w("scan"),title:o.jsxs(o.Fragment,{children:["QR Scanning",o.jsx("br",{}),"(evacuation process)"]}),subtitle:"Scan QR IDs of evacuees for Relief Operations",titleStyle:{fontSize:"1.5em"},titleBackground:V[300],className:"mx-auto",style:{maxWidth:"25em"}})}),C()&&o.jsx("div",{className:"col-11 col-sm-10 col-lg-6 pb-3 mx-auto my-auto",children:o.jsx(I,{onClick:()=>w("end"),title:"End Evacuation Process",subtitle:`Stop the Evacuation Process now.
                        Stopping the evacuation process will ensure that the relief distribution
                        cannot proceed any further. Thus, the system will not record anymore
                        updates prior to relief distribution`,titleStyle:{fontSize:"1.8em"},titleBackground:Z[300],className:"mx-auto",style:{maxWidth:"25em"}})}),((k=e==null?void 0:e.loginInfo)==null?void 0:k.Role)==="user"&&!R()&&!P()&&!C()&&o.jsx("div",{className:"col-11 pb-3 d-flex justify-content-center align-items-center",style:{height:"calc(100vh - 15em)"},children:o.jsx("h1",{children:"You are currently not assigned to this event."})})]})})]})}export{oe as Component,se as loader};
