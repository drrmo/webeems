import{j as R,u as Ce,a as Ae,y as $e,r as n,a2 as Pe,a3 as ke,a4 as Re,a5 as Le,b as a,a9 as Te,L as Me}from"./index-a50eb7ee.js";/* empty css                   */import{w as k,S as fe}from"./sweetalert2.all-953600d6.js";import{C as Qe,a as Oe,Q as We,L as Be}from"./ListOccupants-8a7778c2.js";import{B as Fe}from"./Breadcrumb-c6b78098.js";import{C as ve,H as pe}from"./HighlightOffRounded-a10a3f8c.js";import{A as ze}from"./Alert-5e12cda2.js";function Ue(){return window.document.title="QR Scanning (Relief Operation Evacuation) | WebEEMS",R({})}function Xe(){var O,W,B,F,z,V,Y,_,q,G,J,K,U,X,Z,I,ee,ae,te,se,ie,re,le,ne,ce,oe,de,ue,me,he,be,xe,ge,Ee;const s=Ce(),A=Ae(),y=$e(),[e,L]=n.useState({}),[i,p]=n.useState({}),[D,x]=n.useState(null),[S,T]=n.useState(!1),[$,De]=n.useState(null),[w,C]=n.useState(!1),[f,v]=n.useState(!1),[M,je]=n.useState(!1),P=k(fe),u=k(P.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,didOpen:t=>{t.addEventListener("mouseenter",P.stopTimer),t.addEventListener("mouseleave",P.resumeTimer)}})),Q=k(P.mixin({input:"text",inputAttributes:{autocapitalize:"off"},showCancelButton:!0,confirmButtonText:"Look up",showLoaderOnConfirm:!0,preConfirm:t=>Pe(t).then(({success:r})=>R(r?t:null).json()).catch(()=>R(null).json()),allowOutsideClick:()=>!fe.isLoading()}));n.useEffect(()=>{var t,r,m,o,l,d,c,g,h,E,j,b,N;y.state==="idle"&&(M?((t=s==null?void 0:s.loginInfo)==null?void 0:t.Role)==="admin"?(s==null?void 0:s.myAssignedEvent)===null?(A("..",{replace:!0}),u.fire({icon:"error",title:"Invalid Access! You have not selected any Evacuation Event ID."}).then()):((o=(r=s==null?void 0:s.myAssignedEvent)==null?void 0:r.Assigned)!=null&&o.includes((m=s==null?void 0:s.loginInfo)==null?void 0:m.ID)&&ke(s.myAssignedEvent.ID,s.loginInfo.ID).catch(()=>{A("..",{replace:!0}),u.fire({icon:"error",title:"Something went wrong! Please Try Again."}).then()}),w||setTimeout(()=>C(!0),1e3)):(l=s==null?void 0:s.loginInfo)!=null&&l.Permissions.includes("evacuation-scan")&&((g=(c=(d=s==null?void 0:s.myAssignedEvent)==null?void 0:d.Evacuation)==null?void 0:c.Started)==null?void 0:g.getTime())<=Date.now()&&(!((E=(h=s==null?void 0:s.myAssignedEvent)==null?void 0:h.Evacuation)!=null&&E.Ended)||((N=(b=(j=s==null?void 0:s.myAssignedEvent)==null?void 0:j.Evacuation)==null?void 0:b.Ended)==null?void 0:N.getTime())>Date.now())?w||setTimeout(()=>C(!0),1e3):A("..",{replace:!0}):(s!=null&&s.myAssignedEvent||(s==null?void 0:s.myAssignedEvent)===null)&&je(!0))},[s,s==null?void 0:s.myAssignedEvent,y==null?void 0:y.state,A,w,M]),n.useEffect(()=>{var t;if(y.state==="idle"&&w)if((t=s==null?void 0:s.myAssignedEvent)!=null&&t.ID)Re(s.myAssignedEvent.ID,"evac").then(({success:r})=>{e!==r&&L(r),C(!1)}).catch(r=>{console.error(r),C(!1)});else return()=>{T(!1),v(!1),x(null),C(!1),p({}),L({})}},[y==null?void 0:y.state,e,w,s==null?void 0:s.myAssignedEvent]),n.useEffect(()=>{(S&&D!==null||f===!0&&D!==null)&&Le(D).then(({success:t})=>{t&&(p(t),setTimeout(()=>$==null?void 0:$.scrollIntoView({behavior:"smooth"}),15),v(!1))}).catch(console.error)},[$,D,S,i,f]);const ye=n.useCallback(t=>t!==null&&D!==t&&x(t),[D]),Ne=n.useCallback(()=>{var t;return e&&((t=e.Evacuation)==null?void 0:t.Distribution)instanceof Array?e.Evacuation.Distribution.map(({ID:{HouseID:r}})=>r):[]},[e]),Se=n.useCallback(()=>{var t,r,m;return e&&((t=e.Evacuation)==null?void 0:t.Distribution)instanceof Array?e.Evacuation.Distribution.reduce(({Present:o,value:l},{ID:{HouseID:d,Household:{Head:c,Members:g}}},h)=>{const E=["table-light","table-warning","table-secondary","table-info","table-danger"],j=g.reduce((b,N)=>[...b,{Name:N.Name,Suffx:N.Suffx,Age:N.Age}],[c?{Name:c.Name,Suffx:c.Suffx,Age:c.Age}:[]]);return{Present:o,value:[...l,a.jsx("div",{className:"table-responsive p-0 m-0",children:a.jsx("table",{className:`table table-striped-columns table-bordered p-0 m-0 ${E[h%E.length]}`,children:a.jsx("tbody",{children:j.map((b,N)=>a.jsxs("tr",{children:[a.jsx("td",{scope:"row",children:`${b.Name} ${!b.Suffx||b.Suffx==="none"?"":b.Suffx}`}),a.jsx("td",{children:b.Age}),a.jsx("td",{children:o[d].includes(b.Name)?a.jsx(Qe,{color:"success"}):a.jsx(Oe,{color:"error"})})]},`evacuation-occupants-tr-${N}`))})})},`evacuation-occupants-${h}`)]}},{Present:((m=(r=e==null?void 0:e.PreEvacuation)==null?void 0:r.Evacuated)==null?void 0:m.reduce((o,l)=>({...o,[l.ID]:l.Present}),{}))||{},value:[]}):[]},[e]),H=n.useCallback(t=>{var r,m;return(m=(r=e==null?void 0:e.PreEvacuation)==null?void 0:r.Evacuated)==null?void 0:m.reduce((o,{ID:l})=>{var d,c;return o||(i==null?void 0:i.HouseID)===l&&((c=(d=e==null?void 0:e.PreEvacuation)==null?void 0:d.Evacuated)==null?void 0:c.reduce((g,h)=>g||h.ID===l&&h.Present.includes(t),!1))},!1)},[e,i]),He=n.useCallback(t=>{var m,o;t.preventDefault(),t.stopPropagation();const r=i==null?void 0:i.HouseID;((o=(m=e==null?void 0:e.Evacuation)==null?void 0:m.Distribution)==null?void 0:o.length)>0&&e.Evacuation.Distribution.map(l=>l.ID.HouseID).includes(i.HouseID)&&u.fire({icon:"info",title:`Evacuee ID ${r} already received relief aid.`}).then(()=>{p({}),x(null)}),Te(e==null?void 0:e.ID,r).then(({success:l})=>{var d,c,g,h,E,j;l?(u.fire({icon:"success",title:`Evacuee ID ${r} has received relief aid`}).then(()=>p({})),f&&v(!1),x(null)):(c=(d=e==null?void 0:e.Evacuation)==null?void 0:d.Distribution)!=null&&c.map(b=>b.ID.HouseID).includes(r)?(u.fire({icon:"info",title:`Evacuee ID ${r} already received relief aid.`}).then(()=>p({})),f&&v(!1),x(null)):((h=(g=e==null?void 0:e.PreEvacuation)==null?void 0:g.Evacuated)==null?void 0:h.length)===((j=(E=e==null?void 0:e.Evacuation)==null?void 0:E.Distribution)==null?void 0:j.length)?(u.fire({icon:"error",title:`All ${e==null?void 0:e.Evacuation.Distribution.length} evacuess already received relief aid!`,text:"Cannot proceed any further."}).then(()=>p({})),f&&v(!1),x(null)):u.fire({icon:"error",title:`Failed to process Evacuee ID ${r} for Relief Distribution. Please Try Again!`}).then()}).catch(()=>{var l,d,c,g,h,E;(d=(l=e==null?void 0:e.Evacuation)==null?void 0:l.Distribution)!=null&&d.map(j=>j.ID.HouseID).includes(r)?(u.fire({icon:"info",title:`Evacuee ID ${r} already received relief aid.`}).then(()=>p({})),f&&v(!1),x(null)):((g=(c=e==null?void 0:e.PreEvacuation)==null?void 0:c.Evacuated)==null?void 0:g.length)===((E=(h=e==null?void 0:e.Evacuation)==null?void 0:h.Distribution)==null?void 0:E.length)?(u.fire({icon:"error",title:`All ${e==null?void 0:e.Evacuation.Distribution.length} evacuess already received relief aid!`,text:"Cannot proceed any further."}).then(()=>p({})),f&&v(!1),x(null)):u.fire({icon:"error",title:`Failed to process Evacuee ID ${r} for Relief Distribution. Please Try Again!`}).then()})},[i,e,u,f]),we=n.useCallback(t=>{t.preventDefault(),Q.fire({title:"Evacuee QR ID"}).then(r=>{var m,o;r.isConfirmed&&(r.value?(o=(m=e==null?void 0:e.PreEvacuation)==null?void 0:m.Evacuated)!=null&&o.reduce((l,d)=>l||d.ID===r.value.trim(),!1)?(f||v(!0),x(r.value.trim())):(v(!1),x(null),u.fire({icon:"info",title:"Evacuation ID is not registered to the current evacuation event!"}).then()):(v(!1),x(null),u.fire({icon:"info",title:"Evacuation ID not found!"}).then()))})},[Q,u,e,f]);return a.jsxs(a.Fragment,{children:[!(e!=null&&e.ID)&&a.jsx(Me,{}),a.jsx("div",{className:"container pt-3",children:a.jsx(Fe,{items:[{title:"Home",href:"/"},{title:"Evacuation",href:"/evacuation"},{title:"QR Scanning",href:"."},{title:e==null?void 0:e.ID}]})}),a.jsx("div",{className:"container mb-5 pb-3 main-container bg-light bg-opacity-50",children:a.jsxs("div",{className:"row overflow-hidden w-100 h-100 my-auto mx-auto mx-lg-0",children:[a.jsx("div",{className:"col-12 col-md-9 col-lg-8 my-3",children:a.jsxs("div",{className:"card h-100",children:[a.jsx("div",{className:"card-header h2",children:"Evacuation QR Scan"}),a.jsx("div",{className:"card-body",children:a.jsxs("div",{className:"w-100 d-flex flex-column justify-content-center align-items-center",children:[a.jsxs("div",{className:"mt-3",children:[a.jsx(We,{className:"border border-2 rounded-5 mx-auto",videoClassName:"rounded-5",onResult:ye,start:S,style:{width:"300px",height:"300px"}}),a.jsxs("div",{className:"mt-3 d-flex flex-row justify-content-evenly",children:[a.jsx("button",{onClick:()=>T(!S),type:"button",className:`btn btn-outline-${S?"danger":"primary"}`,children:S?"Stop Scanning":"Scan Qr Code"}),a.jsx("button",{onClick:we,type:"button",className:"btn btn-outline-secondary",children:"Manual QR Code"})]})]}),a.jsxs("div",{className:"mt-3",children:["Scanned ID: ",D]}),a.jsxs("div",{className:"d-flex align-items-center justify-content-center mt-5 h4 w-100",children:[a.jsx("div",{className:"border border-2 ps-3 py-2 text-start bg-success-subtle",style:{minWidth:"10em",maxWidth:"20em"},children:"Available Stock:"}),a.jsx("div",{className:`border border-2 text-center py-2 text-light bg-${(O=e==null?void 0:e.Evacuation)!=null&&O.Distribution&&((W=e==null?void 0:e.PreEvacuation)!=null&&W.Evacuated)&&e.Evacuation.Distribution.length>=e.PreEvacuation.Evacuated.length?"danger":(B=e==null?void 0:e.Evacuation)!=null&&B.Distribution&&((F=e==null?void 0:e.PreEvacuation)!=null&&F.Evacuated)&&e.PreEvacuation.Evacuated.length-e.Evacuation.Distribution.length<5?"warning text-dark":"success-subtle text-dark"}`,style:{minWidth:"3em",maxWidth:"3em"},children:(z=e==null?void 0:e.Evacuation)!=null&&z.Distribution&&((V=e==null?void 0:e.PreEvacuation)!=null&&V.Evacuated)?e.MaxCapacity-e.Evacuation.Distribution.length:"-"})]}),a.jsxs("div",{className:"d-flex align-items-center justify-content-center mt-3 h4 w-100",children:[a.jsx("div",{className:"border border-2 ps-3 py-2 text-start bg-info-subtle",style:{minWidth:"10em",maxWidth:"20em"},children:"Relief Distributed:"}),a.jsx("div",{className:`border border-2 text-center py-2 text-light bg-${(Y=e==null?void 0:e.Evacuation)!=null&&Y.Distribution&&((_=e==null?void 0:e.PreEvacuation)!=null&&_.Evacuated)&&e.Evacuation.Distribution.length>=e.PreEvacuation.Evacuated.length?"danger":(q=e==null?void 0:e.Evacuation)!=null&&q.Distribution&&((G=e==null?void 0:e.PreEvacuation)!=null&&G.Evacuated)&&e.MaxCapacity-e.Evacuation.Distribution.length<5?"warning text-dark":"info-subtle text-dark"}`,style:{minWidth:"3em",maxWidth:"3em"},children:(J=e==null?void 0:e.Evacuation)!=null&&J.Distribution?e.Evacuation.Distribution.length:"-"})]})]})}),a.jsx("div",{className:"card-footer"})]})}),a.jsx("div",{className:"col my-3",children:a.jsxs("div",{className:"card h-100",children:[D&&(i==null?void 0:i.HouseID)&&a.jsx("div",{className:"card-header h3",children:i==null?void 0:i.HouseID}),a.jsx("div",{className:"card-body position-relative",style:{float:"left",clear:"both"},ref:De,children:D&&(i==null?void 0:i.HouseID)&&a.jsxs("form",{onSubmit:He,children:[a.jsx("h4",{children:"Head"}),a.jsx("div",{className:"table-responsive",children:a.jsx("table",{className:"table table-striped-columns table-warning",children:a.jsx("tbody",{children:a.jsxs("tr",{children:[a.jsx("td",{scope:"row",className:"text-start",children:a.jsxs("div",{className:"w-100 d-flex flex-row justify-content-start align-items-center text-start",children:[H((U=(K=i==null?void 0:i.Household)==null?void 0:K.Head)==null?void 0:U.Name)?a.jsx(ve,{color:"success",className:"mx-2"}):a.jsx(pe,{color:"error",className:"mx-2"}),a.jsx("div",{className:`${H((Z=(X=i==null?void 0:i.Household)==null?void 0:X.Head)==null?void 0:Z.Name)?"text-dark":"text-secondary"}`,children:((ee=(I=i.Household)==null?void 0:I.Head)==null?void 0:ee.Name)+(((te=(ae=i.Household)==null?void 0:ae.Head)==null?void 0:te.Suffx)!=="none"?` ${((ie=(se=i.Household)==null?void 0:se.Head)==null?void 0:ie.Suffx)||""}`:"")})]})}),a.jsxs("td",{className:`${H((le=(re=i==null?void 0:i.Household)==null?void 0:re.Head)==null?void 0:le.Name)?"text-dark":"text-secondary"} py-3`,children:["(age: ",(ce=(ne=i.Household)==null?void 0:ne.Head)==null?void 0:ce.Age,")"]})]})})})}),a.jsxs("h4",{children:["Members",` (+${(oe=i.Household)==null?void 0:oe.Members.length})`]}),a.jsx("div",{className:"overflow-y-auto overflow-x-hidden border",style:{height:"20em"},children:a.jsx("div",{className:"table-responsive",children:a.jsx("table",{className:"table table-striped-columns",children:a.jsx("tbody",{children:((de=i.Household)==null?void 0:de.Members.length)>0&&((ue=i.Household)==null?void 0:ue.Members.map((t,r)=>a.jsxs("tr",{children:[a.jsx("td",{scope:"row",className:"text-start",children:a.jsxs("div",{className:"w-100 d-flex flex-row justify-content-start align-items-center text-start",children:[H(t.Name)?a.jsx(ve,{color:"success",className:"mx-2"}):a.jsx(pe,{color:"error",className:"mx-2"}),a.jsx("div",{className:`${H(t.Name)?"text-dark":"text-secondary"}`,children:t.Name+(t.Suffx!=="none"?` ${t.Suffx||""}`:"")})]})}),a.jsxs("td",{className:`${H(t.Name)?"text-dark":"text-secondary"} py-3`,children:["(age: ",t.Age,")"]})]},`members_${r}${t.Name.split(" ")[0]}`)))})})})}),a.jsx("br",{}),a.jsxs("div",{className:"w-100 pe-4",children:[a.jsx(ze,{severity:((he=(me=e==null?void 0:e.Evacuation)==null?void 0:me.Distribution)==null?void 0:he.length)>0&&e.Evacuation.Distribution.map(t=>t.ID.HouseID).includes(i.HouseID)?"error":"info",className:"mb-2",children:((xe=(be=e==null?void 0:e.Evacuation)==null?void 0:be.Distribution)==null?void 0:xe.length)>0&&e.Evacuation.Distribution.map(t=>t.ID.HouseID).includes(i.HouseID)?`${i.HouseID} has already received relief goods!`:"Please confirm evacuee(s) receiving the relief goods."}),a.jsx("button",{type:"submit",className:`btn btn-success me-2 ${((Ee=(ge=e==null?void 0:e.Evacuation)==null?void 0:ge.Distribution)==null?void 0:Ee.length)>0&&e.Evacuation.Distribution.map(t=>t.ID.HouseID).includes(i.HouseID)?"disabled":""}`,children:"Confirm"}),a.jsx("button",{type:"reset",className:"btn btn-secondary ms-2",onClick:()=>{x(null),p({})},children:"Cancel"})]})]})}),a.jsx("div",{className:"card-footer position-relative",style:{maxHeight:"20em"},children:a.jsx(Be,{name:"evacuation",labels:Ne(),contents:Se().value,style:{maxHeight:"19em",fontSize:"10pt"},contentStyle:{maxHeight:"19em",fontSize:"10pt",textAlign:"left"}})})]})})]})})]})}export{Xe as Component,Ue as loader};
