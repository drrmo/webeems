import{j as k,a as N,u as T,r as g,R as O,aa as $,S as F,W as H,ab as Q,b as s,Z as W,ac as z}from"./index-a50eb7ee.js";/* empty css                       */import{w as j,S as v}from"./sweetalert2.all-953600d6.js";import"./index-d591f4d5.js";import{M as P}from"./MenuButton-2b400b7f.js";import{B as M}from"./Breadcrumb-c6b78098.js";import"./createSvgIcon-d2f0689e.js";import"./useId-519d9372.js";import"./useControlled-20eeda9a.js";function U(){return window.document.title="Post-Evacuation | WebEEMS",k({})}function X(){var y,I,w,D,R,A,b;const d=N(),e=T(),f=j(v),c=j(v.mixin({toast:!0,position:"top-end",showConfirmButton:!1,timer:5e3,timerProgressBar:!0,didOpen:l=>{l.addEventListener("mouseenter",v.stopTimer),l.addEventListener("mouseleave",v.resumeTimer)}})),E=g.useCallback((l,r,i=!0)=>f.mixin({title:l,input:"select",inputOptions:r,inputPlaceholder:"Select an Evacuation Event ID",confirmButtonText:"Select Evacuation Event",showLoaderOnConfirm:i,showCancelButton:!0,inputValidator:n=>new Promise(o=>{O().then(({success:t})=>{t.map(a=>a.ID).includes(n)?o():o(`ERROR: \`${n}\` is not found`)}).catch(t=>{var a;o(`ERROR: ${(t==null?void 0:t.message)||((a=t==null?void 0:t.error)==null?void 0:a.message)||t}`)})}),allowOutsideClick:()=>!v.isLoading()}),[f]),h=g.useCallback(l=>{var r;switch(l){case"start":{(async()=>{var n,o;let i;if(((n=e==null?void 0:e.loginInfo)==null?void 0:n.Role)==="admin")try{const{success:t}=await H("post"),a=await E("Select Event ID",t.reduce((m,u)=>({"Post-Evacuation ID":{[u.ID]:u.ID,...m["Post-Evacuation ID"]}}),{"Post-Evacuation ID":{}})).fire();if(a.isConfirmed){if(!a.value){c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}i=a.value}else return}catch{c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}f.fire({title:`Start the Post-Evacuation Process \`${i||((o=e==null?void 0:e.myAssignedEvent)==null?void 0:o.ID)}\` now?`,text:"Starting Post-Evacuation will proceed to QR Code Scanning for evacuees to exit for relocation.",icon:"question",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Yes",cancelButtonText:"No"}).then(t=>{var a;t.isConfirmed&&Q(i||((a=e==null?void 0:e.myAssignedEvent)==null?void 0:a.ID)).then(({success:m})=>{var u;m?(c.fire({icon:"success",title:"Successfully Started Post-Evacuation Process!",timer:2e3}).then(()=>d("scan")),((u=e==null?void 0:e.loginInfo)==null?void 0:u.Role)==="admin"&&(e==null||e.setAdminSelectedEventID(i)),d(".")):(c.fire({icon:"error",title:"Failed to Start Post-Evacuation Process! Please Try again",timer:2e3}).then(),d("."))}).catch(m=>{var u,C;c.fire({icon:"error",title:"Failed to Start Post-Evacuation Process! Please Try again",text:`Reason: ${m.message||((u=m.data)==null?void 0:u.message)||((C=m.error)==null?void 0:C.message)||"Something went wrong."}`,timer:2e3}).then(),d(".")})})})().then();break}case"scan":((r=e==null?void 0:e.loginInfo)==null?void 0:r.Role)==="admin"?F("post").then(async({success:i})=>{var o;const n=await E("Select Event ID",i.reduce((t,a)=>({"Post-Evacuation ID":{[a.ID]:a.ID,...t["Post-Evacuation ID"]}}),{"Post-Evacuation ID":{}})).fire();n.isConfirmed&&(n.value?(c.fire({icon:"success",title:`Entering Post-Evacuation \`${n.value}\` QR Scanning`,timer:1e3}).then(()=>d("scan")),((o=e==null?void 0:e.loginInfo)==null?void 0:o.Role)==="admin"&&(e==null||e.setAdminSelectedEventID(n.value)),d(".")):c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then())}).catch(()=>{c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then()}):d("scan");break;case"print":(async()=>{var n,o;let i;if(((n=e==null?void 0:e.loginInfo)==null?void 0:n.Role)==="admin")try{const{success:t}=await $(),a=await E("Select Event ID",t.reduce((m,u)=>({"Post-Evacuation ID":{[u.ID]:u.ID,...m["Post-Evacuation ID"]}}),{"Post-Evacuation ID":{}})).fire();if(a.isConfirmed){if(!a.value){c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}i=a.value}else return}catch{c.fire({title:"Something went wrong. Please try again later.",icon:"error"}).then();return}window.open(`/print-summary/${i||((o=e==null?void 0:e.myAssignedEvent)==null?void 0:o.ID)}`,"_blank","width=1200,height=1000,top=100,left=100,resizable=no")})().then();break}},[E,f,c,e,d]),S=g.useCallback(()=>{var l,r,i,n;return!!((l=e==null?void 0:e.loginInfo)!=null&&l.Permissions.includes("post-evacuation-modify")&&!((i=(r=e==null?void 0:e.myAssignedEvent)==null?void 0:r.PostEvacuation)!=null&&i.Started)||((n=e==null?void 0:e.loginInfo)==null?void 0:n.Role)==="admin")},[(y=e==null?void 0:e.loginInfo)==null?void 0:y.Permissions,(I=e==null?void 0:e.loginInfo)==null?void 0:I.Role,e==null?void 0:e.myAssignedEvent]),p=g.useCallback(()=>{var l,r,i,n,o,t,a;return!!((l=e==null?void 0:e.loginInfo)!=null&&l.Permissions.includes("post-evacuation-scan")&&(e!=null&&e.myAssignedEvent)&&((i=(r=e.myAssignedEvent.PostEvacuation)==null?void 0:r.Started)==null?void 0:i.getTime())<=Date.now()&&(!((n=e.myAssignedEvent.PostEvacuation)!=null&&n.Ended)||((t=(o=e.myAssignedEvent.PostEvacuation)==null?void 0:o.Ended)==null?void 0:t.getTime())>Date.now())||((a=e==null?void 0:e.loginInfo)==null?void 0:a.Role)==="admin")},[(w=e==null?void 0:e.loginInfo)==null?void 0:w.Permissions,(D=e==null?void 0:e.loginInfo)==null?void 0:D.Role,e.myAssignedEvent]),B=g.useCallback(()=>{var l,r,i,n,o,t;return!!((l=e==null?void 0:e.loginInfo)!=null&&l.Permissions.includes("post-evacuation-print")&&(e!=null&&e.myAssignedEvent)&&((r=e.myAssignedEvent.PostEvacuation)!=null&&r.Started)&&(!((i=e.myAssignedEvent.PostEvacuation)!=null&&i.Ended)||((o=(n=e.myAssignedEvent.PostEvacuation)==null?void 0:n.Ended)==null?void 0:o.getTime())>Date.now())||((t=e==null?void 0:e.loginInfo)==null?void 0:t.Role)==="admin")},[(R=e==null?void 0:e.loginInfo)==null?void 0:R.Permissions,(A=e==null?void 0:e.loginInfo)==null?void 0:A.Role,e.myAssignedEvent]);return s.jsxs(s.Fragment,{children:[s.jsx("div",{className:"container pt-3",children:s.jsx(M,{items:[{title:"Home",href:"/"},{title:"post-evacuation",href:"/post-evacuation"}]})}),s.jsx("div",{className:"container main-container",children:s.jsxs("div",{className:"row mx-auto w-100 mb-5 h-75 justify-content-center align-items-center",style:{minHeight:"80vh"},children:[S()&&s.jsx("div",{className:"col-11 col-sm-10 col-lg-6 pb-3 mx-auto my-auto",children:s.jsx(P,{onClick:()=>h("start"),title:"Start Post-Evacuation Process",subtitle:`Start the Post-Evacuation Process now.
                            Starting the Post-evacuation process will proceed to QR Code Scanning
                            for Evacuees leaving the Evacuation Site for relocation.`,className:"mx-auto",titleStyle:{fontSize:"1.8em"},style:{maxWidth:"25em"}})}),p()&&s.jsx("div",{className:"col-11 col-sm-10 col-lg-6 pb-3 mx-auto my-auto",children:s.jsx(P,{onClick:()=>h("scan"),title:s.jsxs(s.Fragment,{children:["QR Scanning",s.jsx("br",{}),"(post-evacuation process)"]}),subtitle:"Scan QR IDs of evacuees leaving the building for relocation.",titleStyle:{fontSize:"1.5em"},titleBackground:W[300],className:"mx-auto",style:{maxWidth:"25em"}})}),B()&&s.jsx("div",{className:"col-11 col-sm-10 col-lg-6 pb-3 mx-auto my-auto",children:s.jsx(P,{onClick:()=>h("print"),title:s.jsx(s.Fragment,{children:"Print Summary Report"}),subtitle:"Print a summary report regarding the evacuation event.",titleStyle:{fontSize:"1.5em"},titleBackground:z[300],className:"mx-auto",style:{maxWidth:"25em"}})}),((b=e==null?void 0:e.loginInfo)==null?void 0:b.Role)==="user"&&!S()&&!p()&&s.jsx("div",{className:"col-11 pb-3 d-flex justify-content-center align-items-center",style:{height:"calc(100vh - 15em)"},children:s.jsx("h1",{children:"You are currently not assigned to this event."})})]})})]})}export{X as Component,U as loader};
